{% extends 'layout/base.html' %}

{% load static %}

{% block additional_css %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

{% endblock %}

{% block content %}



<!-- MAIN CLIENTS -->
    

    <div class="row">

        <div class="col-xl-4 col-xxl-4 col-lg-4 col-sm-3">
            <div class="widget-stat card">
                <div class="card-body  p-4">
                    <div class="media ai-icon">
                        <span class="me-3 bgl-warning text-warning">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 48C288 21.49 309.5 0 336 0H432C458.5 0 480 21.49 480 48V192H520V120C520 106.7 530.7 96 544 96C557.3 96 568 106.7 568 120V192H592C618.5 192 640 213.5 640 240V464C640 490.5 618.5 512 592 512H336C309.5 512 288 490.5 288 464V48zM352 112C352 120.8 359.2 128 368 128H400C408.8 128 416 120.8 416 112V80C416 71.16 408.8 64 400 64H368C359.2 64 352 71.16 352 80V112zM368 160C359.2 160 352 167.2 352 176V208C352 216.8 359.2 224 368 224H400C408.8 224 416 216.8 416 208V176C416 167.2 408.8 160 400 160H368zM352 304C352 312.8 359.2 320 368 320H400C408.8 320 416 312.8 416 304V272C416 263.2 408.8 256 400 256H368C359.2 256 352 263.2 352 272V304zM528 256C519.2 256 512 263.2 512 272V304C512 312.8 519.2 320 528 320H560C568.8 320 576 312.8 576 304V272C576 263.2 568.8 256 560 256H528zM512 400C512 408.8 519.2 416 528 416H560C568.8 416 576 408.8 576 400V368C576 359.2 568.8 352 560 352H528C519.2 352 512 359.2 512 368V400zM224 160C224 166 223 171 222 176C242 190 256 214 256 240C256 285 220 320 176 320H160V480C160 498 145 512 128 512C110 512 96 498 96 480V320H80C35 320 0 285 0 240C0 214 13 190 33 176C32 171 32 166 32 160C32 107 74 64 128 64C181 64 224 107 224 160z"/></svg>
                        </span>
                        <div class="media-body">
                            <p class="mb-1">Alarmas instaladas</p>
                            <h4 class="mb-0"> {{barrios|length}} {% if barrios|length != 1 %} barrios {% else %}barrio {% endif %}</h4>
                            <h5 class="mb-0"> {{n_alertas}} {% if n_alertas != 1 %} alertas {% else %} alerta {% endif %} este mes </h5>

                        </div>
                    </div>
                    
                </div>
            </div>
        </div>


        <div class="col-xl-4 col-xxl-4 col-lg-4 col-sm-3">
            <div class="widget-stat card">
                <div class="card-body  p-4">
                    <div class="media ai-icon">
                        <span class="me-3 {% if ultima.tipo == "Emergencia" %}
                                            bgl-success text-success
                                        {% elif ultima.tipo == "SOS" %}
                                            bgl-info text-info
                                        {% elif ultima.tipo == "Fuego" %}
                                            bgl-danger text-danger
                                        {% else %}
                                            bgl-primary text-primary
                                        {% endif %} bgl-primary text-primary">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M160.9 59.01C149.3 52.6 134.7 56.76 128.3 68.39C117.6 87.6 112 109.4 112 131.4c0 19.03 4.031 37.44 11.98 54.62c4.047 8.777 12.73 13.93 21.8 13.93c3.375 0 6.797-.7187 10.05-2.219C167.9 192.2 173.1 177.1 167.5 165.9C162.5 155.1 160 143.5 160 131.4c0-13.93 3.547-27.69 10.25-39.81C176.7 80.04 172.5 65.42 160.9 59.01zM62.61 2.363C46.17-4.32 27.58 3.676 20.95 20.02C7.047 54.36 0 90.69 0 127.1C0 165.3 7.047 201.7 20.95 236C25.98 248.5 37.97 256 50.63 256C54.61 256 58.69 255.3 62.61 253.7C79 247 86.91 228.4 80.27 212C69.47 185.3 64 157.1 64 128c0-29.06 5.469-57.3 16.27-83.99C86.91 27.64 79 8.988 62.61 2.363zM555 20.02c-6.609-16.41-25.23-24.31-41.66-17.66c-16.39 6.625-24.3 25.28-17.66 41.65C506.5 70.7 512 98.95 512 128c0 29.06-5.469 57.31-16.27 83.1C489.1 228.4 497 247 513.4 253.7C517.3 255.3 521.4 256 525.4 256c12.66 0 24.64-7.562 29.67-20C568.1 201.7 576 165.3 576 127.1C576 90.69 568.1 54.36 555 20.02zM420.2 58.23c-12.03 5.562-17.28 19.81-11.72 31.84C413.5 100.9 416 112.5 416 124.6c0 13.94-3.547 27.69-10.25 39.81c-6.422 11.59-2.219 26.22 9.375 32.62c3.688 2.031 7.672 3 11.61 3c8.438 0 16.64-4.47 21.02-12.37C458.4 168.4 464 146.6 464 124.6c0-19.03-4.031-37.43-11.98-54.62C446.5 57.89 432.1 52.7 420.2 58.23zM301.8 65.45C260.5 56.78 224 88.13 224 128c0 23.63 12.95 44.04 32 55.12v296.9c0 17.67 14.33 32 32 32s32-14.33 32-32V183.1c23.25-13.54 37.42-40.96 30.03-71.18C344.4 88.91 325 70.31 301.8 65.45z"/></svg>
                        </span>
                        <div class="media-body">
                            {% if ultima %}
                            <p class="mb-1">Última alerta</p>
                            <h4 class="mb-0">  {{ ultima.tipo}} - {{ultima.miembro.vivienda.alarma_vecinal}} </h4>
                            <h5 class="mb-0">{{ultima.datetime|date:"l d/m" }} {{ ultima.datetime|time:"H:i" }} hs en {{ultima.miembro.vivienda}}  </h5>
                            {% else %}
                            <p class="mb-1">Última alerta</p>
                            <h4 class="mb-0">   </h4>
                            <h5 class="mb-0">sin alertas registradas </h5>
                            {% endif %}
                            

                        </div>
                    </div>
                    
                </div>
            </div>
        </div>



        <div class="col-xl-4 col-xxl-4 col-lg-4 col-sm-3">
            <div class="widget-stat card">
                <div class="card-body  p-4">
                    <div class="media ai-icon">
                        <span class="me-3 bgl-secondary text-secondary">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M511.8 287.6L512.5 447.7C512.6 483.2 483.9 512 448.5 512H128.1C92.75 512 64.09 483.3 64.09 448V287.6H32.05C14.02 287.6 0 273.5 0 255.5C0 246.5 3.004 238.5 10.01 231.5L266.4 8.016C273.4 1.002 281.4 0 288.4 0C295.4 0 303.4 2.004 309.5 7.014L416 100.7V64C416 46.33 430.3 32 448 32H480C497.7 32 512 46.33 512 64V185L564.8 231.5C572.8 238.5 576.9 246.5 575.8 255.5C575.8 273.5 560.8 287.6 543.8 287.6L511.8 287.6zM288 288C323.3 288 352 259.3 352 224C352 188.7 323.3 160 288 160C252.7 160 224 188.7 224 224C224 259.3 252.7 288 288 288zM192 416H384C392.8 416 400 408.8 400 400C400 355.8 364.2 320 320 320H256C211.8 320 176 355.8 176 400C176 408.8 183.2 416 192 416z"/></svg>
                        </span>
                        <div class="media-body">
                            <p class="mb-1">Usuarios Activos</p>
                            <h4 class="mb-0 fs-3">{{n_usuarios}} {% if n_usuarios != 1 %} personas {% else %} persona 
                                {% endif %} en {{n_casas}}  {% if n_casas != 1 %} viviendas {% else %} vivienda {% endif %} </h4>
                        </div>
                    </div>
                    
                </div>
            </div>
        </div>

        


        <div class="row page-titles">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{% url 'dashboard:index' %}">Inicio</a></li>

                <li class="breadcrumb-item active"><a>Alarmas Vecinales</a></li>
            </ol>
        </div>


        <div class="col-xl-12">            
            <div class="card students-list">

                
                <div class="d-flex flex-row-reverse px-xs-1 mx-5 mt-5 mb-4">
                    <button type="button" class="btn btn-primary py-4 px-4" data-bs-toggle="modal" data-bs-target="#exampleModal">
                        <i class="fa fa-plus fs-3 me-3"></i><i class="fa-solid fa-broadcast-tower fs-2"></i></button>

                            
                </div>      


                <!-- TABLE CLIENTS -->
                <div class="card-body py-0">
                    
                            <div class="table-responsive">
                                <table id="example4" style="min-width: 845px">
                                    <thead>
                                        <tr>
                                            <th>ALARMA</th>
                                            <th>GOOGLE HOME</th>
                                            <th>VIVIENDAS</th>

                                            <th>USUARIOS</th>
                                            <th>FUEGO</th>
                                            <th>SOS</th>
                                            <th>URGENCIA</th>
                                            <th>ÚLTIMA ALERTA</th>
                                            <th>ALTA</th>

                                            <th></th>
                                        </tr>
                                    </thead>
                                    <tbody>{% if barrios %}
                                        {% for barrio in barrios %}
                                        <tr>

                                            <td>
                                                <div class="d-flex align-items-center">
                                                    <a class="mb-0 fs-16 font-w500" href="{% url 'dashboard:barrio' pk=barrio.id%}">{{barrio.nombre}}</a>
                                                </div>
                                            </td>
                                            <td>{{barrio.google_account}}</td>
                                            <td>{{barrio.get_n_viviendas}}</td>
                                            <td>{{barrio.get_n_usuarios}}</td>

                                            <td> {{barrio.get_f|length}}</td>
                                            <td> {{barrio.get_s|length}}</td>
                                            <td> {{barrio.get_e|length}}</td>
                                            <td> {{barrio.get_alarmas|last}}</td>

                                            <td>{{barrio.created_at}}</td>

                                            <td>
                                                <div class="d-flex flex-row">

                                                    <!-- map BUTTON -->
                                                    <a href="https://www.google.com/maps/place/{{barrio.nombre}}/" class="shadow-sm btn btn-info px-3 mx-1"><i class="fa-solid fa-location-dot fs-4"></i>
                                                    </a>  
                                                    
                                                        <!-- delete BUTTON -->
                                                            <button type="button" class="shadow-sm btn btn-danger px-3 mx-1" data-bs-toggle="modal" data-bs-target="#deletebarrio{{barrio.id}}">
                                                            <i class="fa-solid fa-trash fs-7"></i>
                                                            </button>                                                                                  
                                                        <!-- edit BUTTON -->

                                                            <a href="{% url 'dashboard:barrioedit' pk=barrio.id %}" class="px-3 shadow-sm btn btn-secondary mx-1">
                                                                <i class="fa-solid fa-pen-to-square "></i>
                                                            </a>                                                
                                                </div>                                        
                                            </td>
                                        </tr>
                                        {% endfor %}
                                        {% endif %}

                                    </tbody>
                                </table>
                            </div>

                </div>
                <div class="form-floating pt-4 my-3 d-flex flex-row-reverse">

                    <a href="{% url 'dashboard:index' %}" class="btn fs-4 mx-2">
                        <i class="fa-solid fa-arrow-left me-2 fs-4"></i> Volver
                    </a>
                </div>
            </div>
        </div>
    </div>
<!-- end MAIN barrios -->


<!-- modals delete barrios -->
    {% for barrio in barrios %}
        <div class="modal" id="deletebarrio{{barrio.id}}">
            {% include 'dashboard/sistema/barrios/deletebarrio.html' %}
        </div>
    {% endfor %}


<!-- START modal add barrio -->
    <div class="modal fade " id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Crear Alarma Vecinal</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>           
                <form  method="post">
                    {% csrf_token %}
                        <div class="modal-body">
                            <div class="pt-1 pb-4">
                                <div class="formcontrol">                                         
                                    <div class="form-floating mb-3">
                                    
        
                                        <div class="form-group my-3">
                                            
                                            {{addform.nombre}}
                                        </div>
                                        <div class="form-group my-3">
                                            {{addform.google_account}}
                                        </div>


                                        <div class="form-group my-3">
                                            {{addform.altitud}}
                                        </div>


                                        <div class="form-group my-3">
                                            {{addform.latitud}}
                                        </div>


                                        <div class="form-group my-3">
                                            {{addform.area}}
                                        </div>


                                        <div class="form-group my-3">
                                            {{addform.descripcion}}
                                        </div>

                                        <div class="row form-group my-3">
                                            <div class="bootstrap-popover d-inline-block col-9">

                                             {{addform.whatsapp_group}}
                                            </div>

                                            <div class="bootstrap-popover d-inline-block col-3">
                                                <button type="button" class="btn btn-primary px-4 " data-bs-container="body" data-bs-toggle="popover" data-bs-placement="right"
                                                
                                                data-bs-content=
                                                "
                                                  [1]  Ve al Grupo de WhatsApp y toca los puntitos . 

                                               . . . [2]  . . . . Ahora en  < Participantes > .  .  . . 

                                                . .  . . . . . . . . [3]   Busca el  . . . . . < Enlace de invitación al Grupo > 
                                                
                                                [4] . . . .  Encuentra el ID al final del link: . . . . . chat.whatsapp.com/'<ID_de_tu_grupo>'  . . " 
                                                
                                                title="ID del Grupo de WhatsApp ">

                                                    ¿cómo lo consigo?</button>
                                            </div>

                                        </div>

                                        
        
                                    </div>
                                </div>       
        
                                
                            </div>
                            <div class="form-floating my-3 text-center">
                                <button type="submit" class=" fs-3 shadow-sm btn btn-secondary" name="addnew"><i class="fa fa-plus me-2 fs-3 me-3"></i> Agregar </button>
                            </div>
                        </div>
                    </form>
            </div>
        </div>
    </div>
<!-- END modal add barrio -->
{% endblock %}


{% block additional_js %}
    <!-- NEWMODAL -->
        <script>
            const deletebarrio = new bootstrap.Modal('#deletebarrio',   {keyboard: true}    )
        </script>


{% endblock %}